title: Androidå›¾ç‰‡åº“--Glide Wikiä¸­æ–‡ç¿»è¯‘
date: 2016-01-24 10:32:54
description: Glide Wikiä¸­æ–‡ç¿»è¯‘ Version 0.1ã€‚Glideæ˜¯ä¸€ä¸ªAndroidå›¾ç‰‡åº“ï¼Œç¡®åˆ‡åœ°è¯´åº”å½“å«ã€åª’ä½“æ¡†æ¶ã€ã€‚æ”¯æŒå›¾ç‰‡ã€Gifã€åŸç”Ÿè§†é¢‘çš„åŠ è½½ã€‚ä½¿ç”¨ç®€å•ï¼Œæ€§èƒ½ä¼˜å¼‚ï¼ŒGoogleæ¨èã€‚
categories:
- æŠ€æœ¯
tags:
- Android
- ä¸»æ¡†æ¶
---
## åº
æœ€è¿‘ï¼Œä¸€ç›´åœ¨æ£é¼“Glideè¿™ä¸ªå›¾ç‰‡åº“ï¼Œç¡®åˆ‡åœ°è¯´åº”å½“å«ã€åª’ä½“æ¡†æ¶ã€ã€‚ä¸ºäº†æ”¯æŒGifæ’­æ”¾ï¼Œé¡¹ç›®ä¸­ä½¿ç”¨Glideä»£æ›¿äº†Universal Image Loaderã€‚èµ·åˆæˆ‘ä»¬æ‰“ç®—ä½¿ç”¨çš„æ˜¯Frescoæ–¹æ¡ˆï¼Œæœ€ç»ˆå› ä¸ºLibä½“ç§¯çš„é—®é¢˜æ”¾å¼ƒã€‚ä¸‡ä¸‡æ²¡æƒ³åˆ°apkçš„sizeè¿™ä¹ˆæ•æ„Ÿï¼Œå›½å¤–å¾ˆå¤šæ¨å¹¿æœåŠ¡æ˜¯æ›´å…·apkä½“ç§¯æ”¶è´¹çš„ï¼Œ3Mä¸€ä¸ªé—¨æ§›ï¼Œ5Mä¸€ä¸ªé—¨æ§›ã€‚frescoå¼•å…¥ä¹‹åå³ä½¿ä½¿ç”¨proguardã€7zipï¼Œapkçš„å¤§å°ä¹Ÿå¢åŠ çš„1mï¼Œå¤šå¹³å°çš„osåº“æ˜¯ä¸ªå¤§å¤´ï¼Œç¬¬ä¸‰ä¸–ç•Œçš„åº”ç”¨å¸‚åœºè¿˜ä¸æ”¯æŒæŒ‰å¹³å°åˆ†å‘ğŸ˜“ã€‚ã€‚
Glideçš„ä½¿ç”¨è¿˜ä¸æ·±å…¥ï¼Œä»…ä»…åœç•™åœ¨Apiçš„èŒƒç•´ï¼Œä¸ºäº†è§£å†³bugï¼Œè·Ÿè¸ªäº†ä»£ç ï¼Œä¹Ÿæ˜¯äº‘é‡Œé›¾é‡Œã€‚ä¸å¾—ä¸è¯´ï¼ŒGlideæºç çš„è®¾è®¡ååˆ†NBï¼Œé¢å‘æ¥å£çš„ç†å¿µè´¯å½»çš„å¾ˆå½»åº•ï¼Œæ˜¯ä¸€ä¸ªå­¦ä¹ è®¾è®¡çš„å¥½demoã€‚
GitHubçš„READMEä½œä¸ºæœ€ç®€å•çš„å…¥é—¨è¶³å¤Ÿäº†ï¼Œä½†æ˜¯é‡åˆ°å…·ä½“é—®é¢˜è¿˜æ˜¯è¦ç†è§£ä¸€äº›è®¾è®¡æ€æƒ³çš„ï¼ŒGitHubä¸Šçš„Wikiæœ‰ä¸€ä»½ä¸é”™çš„æ–‡æ¡£ï¼Œå¯æƒœæœ¨æœ‰ä¸­æ–‡ï¼Œæ­£å¥½å­¦ä¹ çš„è¿‡ç¨‹ä¸­ç¿»è¯‘ä¸€ä¸‹ã€‚ï¼ˆ2016-1-24æ—¥ï¼‰
ä¸¤ç¯‡ä¸­æ–‡å…¥é—¨å¯ä»¥å‚è€ƒ

* [Googleæ¨èçš„å›¾ç‰‡åŠ è½½åº“Glideä»‹ç»](http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2015/0327/2650.html)
* [Glide ä¸€ä¸ªä¸“æ³¨äºå¹³æ»‘æ»šåŠ¨çš„å›¾ç‰‡åŠ è½½å’Œç¼“å­˜åº“](http://www.jianshu.com/p/4a3177b57949)

### åè¯è§£é‡Š
Target
Model
Signature

## ç›®å½•
* ä¸»ç›®å½•
* ç¼“å­˜æœºåˆ¶ä¸ç¼“å­˜å¤±æ•ˆ
* Glideé…ç½®
* è‡ªå®šä¹‰Target
* è°ƒè¯•ä¸é”™è¯¯å¤„ç†
* ä½¿ç”¨Glideä¸‹è½½è‡ªå®šä¹‰å¤§å°å›¾ç‰‡
* ä¸å…¶ä»–åº“çš„æ•´åˆ
* åå°çº¿ç¨‹çš„åŠ è½½ä¸ç¼“å­˜
* Glideä¸­çš„èµ„æºå¤ç”¨
* å¿«ç…§ï¼ˆSnapshotsï¼‰
* å›¾å½¢å˜æ¢ï¼ˆTransformationsï¼‰

## ä¸»ç›®å½•
### æé—®
å¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜ï¼Œå¯ä»¥åœ¨Githubä¸Šæå‡ºæˆ–è€…å‘é€emailåˆ°æˆ‘ä»¬çš„é‚®ä»¶åˆ—è¡¨ï¼Œä¹Ÿå¯ä»¥åœ¨IRC(Internet Relay Chat ç½‘ç»œä¸­ç»§èŠå¤©ï¼Ÿ)é¢‘é“ä¸Šè”ç³»æˆ‘ä»¬ã€‚
### 3.0ç‰ˆæœ¬çš„æ–°ç‰¹æ€§
* æ”¯æŒGifåŠ¨ç”»æ’­æ”¾è§£ç  - ä¸åŠ è½½å›¾ç‰‡ç›¸åŒï¼Œåªæœ‰è°ƒç”¨Glide.with(...).load(...)ï¼Œå¦‚æœä½ åŠ è½½çš„æ˜¯åŠ¨ç”»Gifï¼ŒGlideä¼šè‡ªåŠ¨åŠ è½½å®ƒå¹¶æŠŠgifæ˜¾ç¤ºåœ¨ä¸€ä¸ªè‡ªå®šä¹‰çš„Drawableä¸Šï¼ˆæ³¨ï¼šGifDrawableï¼‰ã€‚æ­¤å¤–ï¼Œä½ è¿˜å¯ä»¥æ§åˆ¶çš„æ›´å¤šï¼Œæ¯”å¦‚

```java
// ä½ æƒ³åŠ è½½Gifä¸ºä¸€å¼ é™æ€å›¾ç‰‡
Glide.with(context).load(...).asBitmap()ã€‚
// æˆ–è€…ä½ æƒ³åªæœ‰åŠ è½½å¯¹è±¡æ˜¯Gifæ—¶æ‰èƒ½åŠ è½½æˆåŠŸ
Glide.with(context).load(...).asGif()ã€‚
```

* æœ¬åœ°è§†é¢‘æ’­æ”¾æŠ€æœ¯ - é™¤äº†è§£ç Gifï¼ŒGlideä¹Ÿèƒ½è§£ç ä½ è®¾å¤‡ä¸Šçš„è§†é¢‘ï¼ˆvideoï¼‰ã€‚ä½¿ç”¨æ–¹æ³•å’ŒåŠ è½½gifç›¸åŒï¼ŒGlideæ”¯æŒæ‰€æœ‰Androidå¯ä»¥ç›´æ¥è§£ç çš„è§†é¢‘ã€‚
* æ”¯æŒç¼©ç•¥å›¾åŠ è½½ - æœ‰æ—¶æˆ‘ä»¬å¸Œæœ›å‡å°‘ç”¨æˆ·ç­‰å¾…çš„æ—¶é—´åˆä¸æƒ³ç‰ºç‰²å›¾ç‰‡çš„è´¨é‡ï¼Œæˆ‘ä»¬å¯ä»¥åŒæ—¶åŠ è½½å¤šå¼ å›¾ç‰‡åˆ°ä¸€ä¸ªViewä¸­ï¼Œå…ˆåŠ è½½ç¼©ç•¥å›¾ï¼ˆåªæœ‰viewçš„1/10å¤§å°ï¼‰ï¼Œç„¶åå†åŠ è½½ä¸€ä¸ªå®Œæ•´çš„å›¾åƒè¦†ç›–åœ¨ä¸Šé¢ã€‚ä½¿ç”¨ä¸‹é¢çš„ä»£ç 

```java
Glide.with(yourFragment).load(yourUrl).thumbnail(0.1f).into(yourView)
```

å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥ä¼ å…¥ä¸€ä¸ªrequeståˆ°`.thumbnail()`å‡½æ•°ä¸­ä½œä¸ºå‚æ•°ã€‚

* ä¸ç”Ÿå‘½å‘¨æœŸç›¸æ•´åˆ - åŠ è½½è¯·æ±‚ç°åœ¨ä¼šè‡ªåŠ¨åœ¨onStopä¸­æš‚åœåœ¨ï¼ŒonStartä¸­é‡æ–°å¼€å§‹ã€‚ä¸ºäº†èŠ‚çº¦ç”µé‡ï¼ŒGifåŠ¨ç”»ä¹Ÿä¼šåœ¨onStopä¸­è‡ªåŠ¨æš‚åœã€‚æ­¤å¤–ï¼Œå½“è®¾å¤‡çš„è¿æ¥çŠ¶æ€æ”¹å˜æ—¶ï¼Œæ‰€æœ‰å¤±è´¥çš„è¯·æ±‚ä¼šè‡ªåŠ¨é‡è¯•ï¼Œç¡®ä¿Glideä¸ä¼šå› ä¸ºä¸´æ—¶æ€§çš„è¿æ¥é—®é¢˜ï¼Œå¯¼è‡´è¯·æ±‚æ°¸è¿œå¤±è´¥ã€‚
* è½¬ç  - é™¤äº†è§£ç èµ„æºï¼ŒGlideçš„`.toBytes()`å’Œ`.transcode()`æ–¹æ³•å…è®¸ä½ åœ¨åå°æ­£å¸¸åœ°è·å–ã€è§£ç ã€å˜æ¢ä¸€å¼ å›¾ç‰‡ã€‚è€Œä¸”ï¼Œåœ¨è¿™äº›è°ƒç”¨ä¸­ï¼Œä½ å¯ä»¥æŠŠå›¾ç‰‡è½¬ç æˆæ›´æœ‰ç”¨çš„æ ¼å¼ï¼Œæ¯”å¦‚ï¼Œä¸Šä¼ ä¸€å¼ å¤§å°ä¸º250*250åƒç´ çš„ç”¨æˆ·å¤´åƒçš„å›¾ç‰‡bytesæ•°æ®ï¼Œä»£ç å¦‚ä¸‹

```java
Glide.with(context)
    .load(â€œ/user/profile/photo/pathâ€)
    .asBitmap()
    .toBytes()
    .centerCrop()
    .into(new SimpleTarget<byte[]>(250, 250) {
        @Override
        public void onResourceReady(byte[] data, GlideAnimation anim) {
            // åœ¨æ­¤å¤„ï¼Œå°†bytesæ•°æ®ä¼ å…¥åå°çº¿ç¨‹ï¼Œå†ä¸Šä¼ ä»–ä»¬
        }
    });
```

* åŠ¨ç”» - Glide3.xæ”¯æŒcross fadesåŠ¨ç”»ï¼ˆ`.crossFade()`ï¼‰å’Œviewçš„å±æ€§åŠ¨ç”»(`.animate(ViewPropertyAnimation.Animator)`)ã€‚æ­¤å¤–ï¼Œè¿˜æœ‰Glide2.0å°±æ”¯æŒçš„viewåŠ¨ç”»ã€‚
* æ”¯æŒ OkHttp å’Œ Volley - ç°åœ¨ä½ å¯ä»¥é€‰æ‹©ç”¨OkHttpã€Volleyæˆ–è€…é»˜è®¤çš„HttpUrlConnectionä½œä¸ºç½‘ç»œæ ˆã€‚OkHttpå’ŒVolleyå¯ä»¥é€šè¿‡æ·»åŠ å¯¹åº”çš„æ•´åˆåº“(integration library)å’Œæ³¨å†Œç›¸åº”çš„`ModelLoaderFactory`æ¥å¼•å…¥ã€‚å…·ä½“æŸ¥çœ‹ReadMeæ–‡ä»¶ã€‚
* å…¶ä»–

### ä»2.0è¿ç§»åˆ°3.0
* å°†æ‰€æœ‰çš„`Glide.load()`æ›¿æ¢ä¸º`Glide.with([fragment/activity/context]).load()`ã€‚
* å°†æ‰€æœ‰çš„è‡ªå®šä¹‰ç›®æ ‡çš„åŠ è½½è°ƒç”¨`Glide.load(url).into(new SimpleTarget(){ ... }).with(context)`æ›¿æ¢æˆ`Glide.with(context).load(url).into(new SimpleTarget(width, height) { ... })`ã€‚

### ç‰¹æ€§
é™¤äº†3.0å¼•å…¥çš„æ–°åŠŸèƒ½ï¼ŒGlideç»§æ‰¿äº†2.0çš„æ‰€æœ‰åŠŸèƒ½ï¼š

* åå°å›¾ç‰‡åŠ è½½
* å¦‚æœä½ ä½¿ç”¨äº†listviewçš„å¤ç”¨æœºåˆ¶ï¼Œé‚£ä¹ˆGlideä¼šè‡ªåŠ¨å–æ¶ˆä½œä¸šï¼ˆjobï¼‰
* å†…å­˜å’Œç£ç›˜ç¼“å­˜
* Bitmapå’Œèµ„æºæ± æ¥å‡å°‘å†…å­˜æŠ–åŠ¨
* æ”¯æŒä»»æ„çš„å›¾åƒå˜æ¢

## ç¼“å­˜æœºåˆ¶ä¸ç¼“å­˜å¤±æ•ˆ
ç¼“å­˜å¤±æ•ˆæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„è¯é¢˜ï¼Œç†æƒ³æƒ…å†µä¸‹ï¼Œä½ å°½å¯èƒ½ä¸è¦è€ƒè™‘è¿™ä¸ªé—®é¢˜ã€‚è¿™ä¸€èŠ‚ä¸»è¦æ˜¯è®©ä½ ç²—ç•¥çš„äº†è§£ä¸€ä¸‹Glideä¸­cacheçš„keyæ˜¯å¦‚ä½•ç”Ÿæˆï¼Œä»¥åŠç»™ä½ ä¸€äº›å…³äºå¦‚ä½•åˆç†åˆ©ç”¨ç¼“å­˜çš„æç¤ºã€‚
### ç¼“å­˜çš„key
`DiskCacheStrategy.RESULT`ç£ç›˜ç¼“å­˜ç­–ç•¥ï¼ˆæ³¨ï¼šé…ç½®çš„ä¸€ç§ç£ç›˜ç¼“å­˜ç­–ç•¥ï¼‰ä½¿ç”¨çš„keyç”±ä»¥ä¸‹å››ä¸ªä¸»è¦éƒ¨åˆ†ç»„æˆï¼š

* DataFetcherçš„æ–¹æ³•`getId()`è¿”å›çš„å­—ç¬¦ã€‚å…¸å‹åœ°ï¼ŒDataFetcherä»…ä»…è¿”å›ç”±æ•°æ®Modelçš„`toString()`æ–¹æ³•å¾—åˆ°çš„å€¼ã€‚æ‰€ä»¥ï¼Œå¦‚æœModelæ˜¯ä¸€ä¸ª**URL**ï¼Œé‚£ä¹ˆä¼šè¿”å›URLçš„å­—ç¬¦ä¸²ï¼Œå¦‚æœModelæ˜¯æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œé‚£ä¹ˆä¼šè¿”å›æ–‡ä»¶çš„**è·¯å¾„**ã€‚ã€‚ã€‚
* å®½å’Œé«˜ã€‚å¦‚æœä½ è°ƒç”¨è¿‡override(width,height)æ–¹æ³•ï¼Œé‚£ä¹ˆå°±æ˜¯æ˜¯å®ƒä¼ å…¥çš„å€¼ã€‚æ²¡æœ‰è°ƒç”¨è¿‡ï¼Œé»˜è®¤æ˜¯é€šè¿‡**Target**çš„`getSize()`æ–¹æ³•è·å¾—è¿™ä¸ªå€¼ã€‚
* å„ç§ç¼–ç å™¨ã€è§£ç å™¨çš„`getId()`æ–¹æ³•è¿”å›çš„å­—ç¬¦ä¸²ã€‚è¿™äº›ç¼–ç å™¨ã€è§£ç å™¨ç”¨äºåŠ è½½å’Œç¼“å­˜ä½ çš„å›¾ç‰‡ã€‚ä»…æœ‰å“ªäº›å †bytesæ•°æ®æœ‰å½±å“çš„ç¼–ç å™¨ã€è§£ç å™¨æ‰ä¼šæœ‰è¿™äº›`id`å€¼ã€‚æ¯”å¦‚ï¼Œä½ åªæœ‰ä¸€ä¸ªå°†bytesæ•°æ®å†™å…¥ç£ç›˜çš„ç¼–ç å™¨ï¼Œé‚£ä¹ˆå®ƒå°±æ²¡æœ‰idå€¼ï¼Œå› ä¸ºä¸ç®¡æ€æ ·å®ƒéƒ½ä¸ä¼šä¿®æ”¹æ•°æ®ã€‚
* å¯é€‰åœ°ï¼Œä½ å¯ä»¥ä¸ºå›¾ç‰‡åŠ è½½æä¾›ç­¾å(Signature),è¯·çœ‹ä¸‹é¢çš„ç¼“å­˜å¤±æ•ˆéƒ¨åˆ†ã€‚

æ‰€æœ‰çš„è¿™äº›keyï¼Œä»¥ç‰¹å®šçš„é¡ºåºè®¡ç®—å‡ºhashå€¼ï¼Œå¹¶å°†è¿™ä¸ªå€¼ä½œä¸ºä¿å­˜å›¾ç‰‡åˆ°ç£ç›˜ä¸Šçš„å”¯ä¸€ä¸”å®‰å…¨çš„æ–‡ä»¶åã€‚

### è‡ªå®šä¹‰ç¼“å­˜å¤±æ•ˆ
é€šå¸¸æƒ…å†µä¸‹æ”¹ç‰ˆç¼“å­˜çš„æ ‡å¿—ï¼ˆkeyï¼‰æ˜¯å›°éš¾çš„ã€‚Glideæä¾›äº†`signature()`APIæ¥æ··å…¥å…¶ä»–æ•°æ®ï¼Œå¸®åŠ©ä½ æ§åˆ¶ç¼“å­˜çš„keyã€‚ç­¾åï¼ˆSignatureï¼‰å¯¹äºå¤šåª’ä½“å†…å®¹ä»¥åŠä½ å¯ä»¥ç»´æŠ¤ç‰ˆæœ¬ä¿¡æ¯çš„ä»»ä½•å†…å®¹æ¥è¯´éƒ½å¾ˆæœ‰ç”¨ã€‚

* åª’ä½“åº“å†…å®¹ - å¯¹äºåª’ä½“åº“å†…å®¹ï¼Œä½ å¯ä»¥ä½¿ç”¨Glideçš„`MediaStoreSignature`ç±»ä½œä¸ºç­¾åï¼Œ MediaStoreSignatureç±»å…è®¸ä½ æ··å…¥æ–‡ä»¶ä¿®æ”¹æ—¶é—´ã€mimeç±»å‹ã€åª’ä½“åº“çš„æ–¹å‘(orientation?)è¿™äº›å€¼ä½œä¸ºç¼“å­˜çš„keyï¼Œè¿™ä¸‰ä¸ªå€¼è¶³ä»¥è®©ä½ å¯é çš„æ•æ‰åˆ°ä»»ä½•ä¿®æ”¹å’Œæ›´æ–°ï¼Œä½¿ä½ å¯ä»¥ç¼“å­˜åª’ä½“åº“çš„ç¼©ç•¥å›¾.?
* æ–‡ä»¶ - ä½ å¯ä»¥ä½¿ç”¨`StringSignature`æ··å…¥æ–‡ä»¶ä¿®æ”¹æ—¶é—´
* url - è™½ç„¶æ˜¯urlå¤±æ•ˆæœ€å¥½çš„æ–¹å¼æ˜¯å½“å†…å®¹å˜åŒ–æ—¶ï¼ŒæœåŠ¡å™¨ä¿®æ”¹urlå¹¶æ›´æ–°å®¢æˆ·ç«¯ï¼Œä½†æ˜¯ä½ ä¹Ÿå¯ä»¥ç”¨`StringSignature`æ··å…¥ä»»æ„çš„å…ƒæ•°æ®ï¼ˆå¦‚ç‰ˆæœ¬å·ï¼‰æ¥ä½¿ç¼“å­˜å¤±æ•ˆã€‚

ä½¿ç”¨String SignatureåŠ è½½æ•°æ®å¾ˆç®€å•ï¼š

```java
Glide.with(yourFragment)
    .load(yourFileDataModel)
    .signature(new StringSignature(yourVersionMetadata))
    .into(yourImageView);
```

åª’ä½“åº“Signatureå¯ä»¥ç›´æ¥ä½¿ç”¨ä»MeidaStore(æ³¨ï¼šä¸€ä¸ªandroid apiï¼‰è·å¾—çš„æ•°æ®

```java
Glide.with(fragment)
    .load(mediaStoreUri)
    .signature(new MediaStoreSignature(mimeType, dateModified, orientation))
    .into(view);
```

ä½ è¿˜å¯ä»¥é€šè¿‡å®ç°`key`æ¥å£æ¥è‡ªå®šä¹‰ç­¾åï¼Œç¡®ä¿å®ç°äº†`equals()`, `hashCode()`å’Œ`updateDiskCacheKey()`è¿™å‡ ä¸ªæ–¹æ³•

```java
public class IntegerVersionSignature implements Key {
    private int currentVersion;
 
    public IntegerVersionSignature(int currentVersion) {
         this.currentVersion = currentVersion;
    } 
 
    @Override 
    public boolean equals(Object o) {
        if (o instanceof IntegerVersionSignature) {
            IntegerVersionSignature other = (IntegerVersionSignature) o;
            return currentVersion = other.currentVersion;
        } 
        return false; 
    } 
 
    @Override 
    public int hashCode() { 
        return currentVersion;
    } 
 
    @Override 
    public void updateDiskCacheKey(MessageDigest md) {
        messageDigest.update(ByteBuffer.allocate(Integer.SIZE).putInt(signature).array());
    } 
} 
```
è¯·ç‰¢è®°ï¼šä¸ºäº†é¿å…æ€§èƒ½ä¸‹é™ï¼Œè¯·åœ¨åå°çº¿ç¨‹ä¸­æ‰¹é‡åŠ è½½ç‰ˆæœ¬å…ƒæ•°æ®(metaData,æ³¨ï¼šä¸€èˆ¬æŸ¥è¯¢æ•°æ®åº“è·å¾—),åªæœ‰è¿™æ ·ï¼Œæ‰èƒ½ç¡®ä¿å½“ä½ æƒ³åŠ è½½å›¾ç‰‡çš„æ—¶å€™ï¼Œè¿™äº›å€¼æ˜¯å¯ç”¨çš„ã€‚
å¦‚æœè¿™äº›æ–¹æ³•éƒ½å¤±è´¥äº†ï¼Œæ¯”å¦‚ï¼Œä½ ä¸èƒ½æ”¹å˜æ ‡è¯†ç¬¦ï¼Œä¹Ÿä¸èƒ½è·Ÿè¸ªä¸€ä¸ªåˆç†çš„ç‰ˆæœ¬å·ã€‚ä½ è¿˜å¯ä»¥ä½¿ç”¨`diskCacheStrategy()`å’Œ`DiskCacheStrategy.NONE.`æ¥å®Œå…¨å…³é—­ç£ç›˜ç¼“å­˜ã€‚

## é…ç½®
### æ‡’åŠ è½½é…ç½®
ä»Glide3.5å¼€å§‹ï¼Œä½ å¯ä»¥ä½¿ç”¨`GlideModule`æ¥å£æ¥æ‡’åŠ è½½é…ç½®Glideä»¥åŠæ³¨å†Œç»„ä»¶ï¼ˆå¦‚`ModelLoaders`),è¿™äº›é…ç½®å°†ä¼šåœ¨ç¬¬ä¸€ä¸ªGlideè¯·æ±‚å‘èµ·çš„æ—¶å€™è¢«è°ƒç”¨ã€‚

### åˆ›å»ºä¸€ä¸ªGlideModule
ä¸ºäº†ä½¿ç”¨å’Œæ³¨å†ŒGlideModuleï¼Œé¦–å…ˆéœ€è¦å®ç°è¯¥æ¥å£ï¼ŒåŠ å…¥ä½ çš„é…ç½®å’Œç»„ä»¶ã€‚

```java
package com.mypackage; 
 
public class MyGlideModule implements GlideModule { 
    @Override public void applyOptions(Context context, GlideBuilder builder) {
        // Apply options to the builder here. 
    } 
 
    @Override public void registerComponents(Context context, Glide glide) {
        // register ModelLoaders here. 
    } 
} 
```

ç„¶åï¼Œæ·»åŠ ä½ çš„å®ç°ç±»åˆ°`proguard.cfg`æ–‡ä»¶ä¸­ï¼Œè®©ä½ çš„moduleå¯ä»¥è¢«åå°„è°ƒç”¨åˆ°ã€‚è¿™ä¸ªæ€§èƒ½å¼€æ”¯å¾ˆå°‘ï¼Œå› ä¸ºæ¯ä¸ªmoduleåªä¼šåœ¨Glideç¬¬ä¸€æ¬¡è¯·æ±‚çš„æ—¶å€™å®ä¾‹åŒ–ä¸€æ¬¡ã€‚

```xml
-keepnames class com.mypackage.MyGlideModule
# or more generally:
#-keep public class * implements com.bumptech.glide.module.GlideModule
```

æœ€åï¼Œæ·»åŠ meta-dataæ ‡è®°åˆ°`AndroidManifest.xml`ï¼Œé‚£æœ‰Glideæ‰èƒ½æ‰¾åˆ°å®ƒã€‚

```xml
<manifest ...>
    <!-- ... permissions -->
    <application ...>
        <meta-data
            android:name="com.mypackage.MyGlideModule"
            android:value="GlideModule" />
        <!-- ... activities and other components -->
    </application>
</manifest>
```

ä½ å¯ä»¥å®ç°ä»»æ„ä¸ª`GlideModule`ï¼Œä½†æ˜¯æ¯ä¸€ä¸ªéƒ½è¦æ·»åŠ åˆ°`proguard.cfg`ï¼Œè€Œä¸”æ¯ä¸€ä¸ªéƒ½è¦åœ¨manifestæœ‰è‡ªå·±çš„meta-dataæ ‡è®°ã€‚

### Libraryå·¥ç¨‹
Libraryå·¥ç¨‹å¯èƒ½å«æœ‰ä¸€ä¸ªæˆ–å¤šä¸ª`GlideModule`ã€‚å½“æˆ‘ä»¬ä½¿ç”¨Gradleï¼ˆæˆ–è€…ä»»ä½•æ”¯æŒmanifeståˆå¹¶çš„æ„å»ºå·¥å…·ï¼‰æ„å»ºappæ—¶ï¼Œå¦‚æœæˆ‘ä»¬æ‰€ä¾èµ–çš„Libraryå·¥ç¨‹çš„manifestä¸­å«æœ‰moduleï¼Œé‚£ä¹ˆè¿™äº›moduleä¼šè‡ªåŠ¨åŠ å…¥åˆ°appä¸­ã€‚å¦‚æœæ„å»ºå·¥å…·ä¸æ”¯æŒmanifeståˆå¹¶ï¼Œé‚£ä¹ˆè¿™äº›libraryå·¥ç¨‹ä¸­çš„moduleå¿…é¡»æ‰‹åŠ¨æ·»åŠ åˆ°ä½ appçš„manifestä¸­ã€‚

### GlideModuleå†²çª
è™½ç„¶Glideå…è®¸æ¯ä¸ªappæ³¨å†Œå¤šä¸ª`Glidemodule`,ä½†æ˜¯ä¸ä¼šä»¥æŸç§ç‰¹å®šçš„é¡ºåºè°ƒç”¨è¿™äº›moduleã€‚æ‰€ä»¥ï¼Œå¦‚æœä½ çš„appä¸­å¤šä¸ª`GlideModules`æˆ–è€…ä¾èµ–çš„libraryå·¥ç¨‹ä¸­æœ‰å¤šä¸ª`GlideModules`ï¼Œä½ å¿…é¡»è´Ÿè´£é¿å…ä»–ä»¬ä¹‹é—´çš„å†²çªã€‚
å¦‚æœå†²çªä¸å¯é¿å…ï¼Œappåº”è¯¥å®šä¹‰è‡ªå·±çš„é»˜è®¤moduleï¼Œè¿™ä¸ªmoduleéœ€è¦æ‰‹åŠ¨è§£å†³è¿™äº›å†²çªï¼Œæä¾›æ‰€æœ‰Libraryå·¥ç¨‹æ‰€éœ€è¦çš„ä¾èµ–ã€‚Gradleçš„ä½¿ç”¨è€…ï¼Œæˆ–è€…ä½¿ç”¨manifeståˆå¹¶çš„ç”¨æˆ·ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„æ ‡ç­¾æ¥æ’é™¤å†²çªçš„moduleã€‚

```xml
<meta-data android:name=â€com.mypackage.MyGlideModuleâ€ tools:node=â€removeâ€ />
```

### å…¨å±€é…ç½®
ä½ å¯ä»¥é…ç½®ä¸€äº›ä½œç”¨äºæ‰€æœ‰è¯·æ±‚çš„å…¨å±€æ€§é…ç½®é¡¹ã€‚è¯·ä½¿ç”¨`GlideModule#applyOptions`æ–¹æ³•ä¸­ï¼ˆä½œä¸ºå‚æ•°ï¼‰æä¾›ç»™ä½ çš„`GlideBuilder`æ¥é…ç½®ã€‚æœ¬èŠ‚ä»£ç ç¤ºä¾‹ä¸­çš„`builder`å°±æ˜¯GlideModuleã€‚

### ç£ç›˜ç¼“å­˜
ä½ å¯ä»¥ä½¿ç”¨`GlideBuilder`çš„`setDiskCache()`æ–¹æ³•è®¾ç½®ç£ç›˜ç¼“å­˜çš„ä½ç½®ã€å¤§å°ï¼ˆæœ€å¤§å€¼ï¼‰ã€‚ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨`DiskCacheAdapter`å½»åº•å…³é—­ç¼“å­˜,æˆ–è€…è‡ªå·±å®ç°`DiskCache`æ¥å£æ¥æ¢æ‰é»˜è®¤å®ç°ã€‚ç£ç›˜ç¼“å­˜ç”±`DiskCache.Factory`æ¥å£çš„å®ä¾‹åœ¨åå°çº¿ç¨‹ä¸­åˆ›å»ºï¼Œä½¿ç”¨åå°çº¿ç¨‹å¯ä»¥é¿å…åœ¨ä¸¥æ ¼æ¨¡å¼ä¸­å‡ºç°é—®é¢˜ã€‚
Glideé»˜è®¤ä½¿ç”¨`InternalCacheDiskCacheFactory`ç±»å»ºç«‹ç£ç›˜ç¼“å­˜ã€‚è¿™ä¸ªå†…éƒ¨ç¼“å­˜å·¥å‚ï¼ˆinternal cache factoryï¼‰ä¼šæŠŠç£ç›˜ç¼“å­˜æ”¾åˆ°åº”ç”¨ç¨‹åºçš„å†…éƒ¨ç¼“å­˜ç›®å½•ä¸­ï¼Œå¹¶ä¸”è®¾ç½®æœ€å¤§ç©ºé—´æ˜¯250MBï¼Œä½¿ç”¨å†…éƒ¨ç¼“å­˜çš„ç›®å½•è€Œä¸æ˜¯SDå¡çš„å¤–éƒ¨ç›®å½•æ„å‘³ç€å…¶ä»–åº”ç”¨ç¨‹åºæ— æ³•è®¿é—®åˆ°ä½ ä¸‹è½½çš„å›¾ç‰‡ã€‚å…·ä½“è¯·æŸ¥çœ‹Androidçš„[å­˜å‚¨é€‰é¡¹ç›¸å…³æ–‡æ¡£](http://developer.android.com/intl/zh-cn/guide/topics/data/data-storage.html#filesInternal)ã€‚
#### å¤§å°
ä½¿ç”¨`InternalCacheDiskCacheFactory`è®¾ç½®ç£ç›˜ç¼“å­˜å¤§å°

```java
builder.setDiskCache(
  new InternalCacheDiskCacheFactory(context, yourSizeInBytes));
```
#### ä½ç½®
ä¹Ÿå¯ä»¥è®¾ç½®ç£ç›˜ç¼“å­˜ä½ç½®
ä½ å¯ä»¥ä½¿ç”¨`InternalCacheDiskCacheFactory `æ¥æŠŠä½ çš„ç£ç›˜ç¼“å­˜æ”¾åˆ°åº”ç”¨ç¨‹åºç§æœ‰çš„å†…éƒ¨å­˜å‚¨ç›®å½•ä¸­ï¼š

```java
builder.setDiskCache(
  new InternalCacheDiskCacheFactory(context, cacheDirectoryName, yourSizeInBytes));
```
ä½ ä¹Ÿå¯ä»¥ç”¨`ExternalCacheDiskCacheFactory `æ¥æŠŠä½ çš„ç£ç›˜ç¼“å­˜æ”¾åˆ°sdå¡çš„å…¬å…±ç¼“å­˜ç›®å½•ä¸Šã€‚

```java
builder.setDiskCache(
  new ExternalCacheDiskCacheFactory(context, cacheDirectoryName, yourSizeInBytes));
```
å¦‚æœä½ æƒ³ç”¨å…¶ä»–è‡ªå®šä¹‰çš„è·¯å¾„ï¼Œå¯ä»¥ç”¨`DiskLruCacheFactory`ç±»çš„æ„é€ å‡½æ•°æ¥å®ç°ã€‚

```java
// If you can figure out the folder without I/O: 
// Calling Context and Environment class methods usually do I/O. 
builder.setDiskCache( 
  new DiskLruCacheFactory(getMyCacheLocationWithoutIO(), yourSizeInBytes)); 
 
// In case you want to specify a cache folder ("glide"): 
builder.setDiskCache( 
  new DiskLruCacheFactory(getMyCacheLocationWithoutIO(), "glide", yourSizeInBytes)); 
 
// In case you need to query the file system while determining the folder: 
builder.setDiskCache(new DiskLruCacheFactory(new CacheDirectoryGetter() { 
    @Override public File getCacheDirectory() {
        return getMyCacheLocationBlockingIO(); 
    } 
}), yourSizeInBytes); 
```
æ³¨æ„ï¼šè¯·ç‰¢è®°ï¼Œå†™æ­»ä»»ä½•å€¼éƒ½ä¸æ˜¯ä¸ªå¥½ä¸»æ„ï¼Œå°¤å…¶æ˜¯ç›®å½•çš„è·¯å¾„ï¼Œå› ä¸ºè‡ªAndroid4.2å¼€å§‹ï¼Œæ”¯æŒå•è®¾å¤‡å¤šç”¨æˆ·ã€‚

å¦‚æœä½ æƒ³å®Œå…¨æ§åˆ¶ç¼“å­˜çš„åˆ›å»ºï¼Œå¯ä»¥è‡ªå·±å®ç°`DiskCache.Factory `æ¥å£ï¼Œä½¿ç”¨`DiskLruCacheWrapper`å¯ä»¥åœ¨ä½ æƒ³è¦çš„ä½ç½®åˆ›å»ºä¸€ä¸ªæ–°çš„ç¼“å­˜ã€‚

```java
builder.setDiskCache(new DiskCache.Factory() { 
    @Override public DiskCache build() { 
        File cacheLocation = getMyCacheLocationBlockingIO();
        cacheLocation.mkdirs();
        return DiskLruCacheWrapper.get(cacheLocation, yourSizeInBytes);
    } 
}); 
```

### å†…å­˜ç¼“å­˜å’Œç¼“å­˜æ± 
`GlideBuilder`ç±»å…è®¸ä½ è®¾ç½®å†…å­˜ç¼“å­˜å¤§å°ï¼Œè€Œä¸”å¯ä»¥å®ç°è‡ªå®šä¹‰çš„`MemoryCache`å’Œ`BitmapPool`ã€‚
#### å¤§å°
é»˜è®¤å¤§å°æ˜¯ç”±`MemorySizeCalculator`ç±»å†³å®šçš„ã€‚MemorySizeCalculatorç±»ä¼šè€ƒè™‘è¯¥è®¾å¤‡çš„å±å¹•å¤§å°ï¼Œå¯ç”¨å†…å­˜æ¥è®¡ç®—å‡ºä¸€ä¸ªåˆç†çš„é»˜è®¤å€¼ã€‚å¦‚æœä½ æƒ³è°ƒæ•´è¿™ä¸ªé»˜è®¤å€¼ï¼Œè¯·æ„å»ºè‡ªå·±çš„å®ä¾‹ã€‚

```java
MemorySizeCalculator calculator = new MemorySizeCalculator(context);
int defaultMemoryCacheSize = calculator.getMemoryCacheSize();
int defaultBitmapPoolSize = calculator.getBitmapPoolSize();
```
å¦‚æœä½ æƒ³åœ¨åº”ç”¨çš„æŸä¸ªé˜¶æ®µåŠ¨æ€è°ƒæ•´Glideçš„å†…å­˜å ç”¨ï¼Œä½ å¯ä»¥é€‰æ‹©ä¸€ä¸ª`MemoryCategory`å¹¶ä½¿ç”¨`setMemoryCategory()`æ–¹æ³•ä¼ å…¥Glideä¸­ï¼š

```java
Glide.get(context).setMemoryCategory(MemoryCategory.HIGH);
```

#### å†…å­˜ç¼“å­˜
Glideçš„å†…å­˜ç¼“å­˜ä¼šåœ¨å†…å­˜ä¸­æŒæœ‰èµ„æºï¼Œå®ƒçš„ä½œç”¨æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥ä¸è¿›è¡ŒIOæ“ä½œè€Œå¿«é€Ÿè·å¾—å¯ç”¨èµ„æºã€‚
ä½ å¯ä»¥ä½¿ç”¨`GlideBuilder`çš„`setMemoryCache()`æ–¹æ³•è®¾ç½®å¤§å°ï¼Œæˆ–è€…è®¾ç½®ä½ å…³äºå†…å­˜ç¼“å­˜çš„è‡ªå®šä¹‰å®ç°ï¼ˆè‡ªå®šä¹‰ç±»ï¼‰ã€‚`LruResourceCache`ç±»æ˜¯Glideçš„é»˜è®¤å®ç°ã€‚ä½ å¯ä»¥é€šè¿‡`LruResourceCache`çš„æ„é€ å‡½æ•°é…ç½®å†…å­˜å ç”¨çš„bytesçš„æœ€å¤§å€¼ã€‚

```java
builder.setMemoryCache(new LruResourceCache(yourSizeInBytes));
```

#### Bitmapæ± 
Glideçš„bitmapæ± ä¸»è¦ä½œç”¨æ˜¯ï¼Œå¯ä»¥è®©å„ç§å°ºå¯¸çš„Bitmapè¢«å¤ç”¨ï¼Œå¯ä»¥å¯è§‚çš„å‡å°‘ç”±åƒåœ¾å›æ”¶å¼•èµ·çš„å†…å­˜æŠ–åŠ¨ã€‚åœ¨è§£ç å›¾ç‰‡æ—¶ï¼Œéœ€è¦ç»™åƒç´ æ•°ç»„åˆ†é…ç©ºé—´ï¼Œè¿™ä¼šè§¦å‘åƒåœ¾å›æ”¶ã€‚
ä½ å¯ä»¥ä½¿ç”¨`GlideBuilder`çš„`setBitmapPool()`æ–¹æ³•è®¾ç½®å¤§å°ï¼Œæˆ–è€…è®¾ç½®ä½ å…³äºBitmapæ± çš„è‡ªå®šä¹‰å®ç°ï¼Œ`LruBitmapPool`ç±»æ˜¯Glideçš„é»˜è®¤å®ç°ã€‚LruBitmapPoolç±»ä½¿ç”¨äº†LRUç®—æ³•ç»´æŠ¤æœ€è¿‘æœ€å¤šä½¿ç”¨çš„Bitmapçš„å°ºå¯¸ã€‚ä½ å¯ä»¥é€šè¿‡`LruBitmapPool`çš„æ„é€ å‡½æ•°é…ç½®å†…å­˜å ç”¨çš„bytesçš„æœ€å¤§å€¼ã€‚

```java
builder.setBitmapPool(new LruBitmapPool(sizeInBytes));
```
### Bitmapæ ¼å¼
`GlideBuilder` ç±»ä¹Ÿå…è®¸ä½ è®¾ç½®ä¸€ä¸ªAppå…¨å±€ä½¿ç”¨çš„Bitmapçš„Configå±æ€§çš„é…ç½®ã€‚
Glideé»˜è®¤ä½¿ç”¨RGB_565ï¼Œå› ä¸ºå®ƒæ¯ä¸ªåƒç´ åªéœ€è¦2bytesï¼ˆ16bitï¼‰çš„ç©ºé—´ï¼Œåªéœ€è¦é«˜è´¨é‡å›¾ç‰‡ï¼ˆæ—¢ç³»ç»Ÿé»˜è®¤çš„`ARGB_8888 `ï¼‰ä¸€åŠçš„å†…å­˜ç©ºé—´ã€‚ä½†æ˜¯ï¼Œè¿™å¯¹äºæŸäº›å›¾ç‰‡è¿™å¯èƒ½ä¼šå‡ºç°ã€æ¡å¸¦ã€çš„é—®é¢˜ï¼Œè€Œä¸”å®ƒä¹Ÿä¸æ”¯æŒé€æ˜åº¦ã€‚
å¦‚æœåœ¨ä½ çš„åº”ç”¨ä¸­ã€æ¡å¸¦ã€æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œæˆ–è€…ä½ éœ€è¦å°½å¯èƒ½å¥½çš„å›¾ç‰‡è´¨é‡ï¼Œä½ å¯ä»¥ä½¿ç”¨`GlideBuilder`çš„`setDecodeFormat`æ–¹æ³•è®¾ç½®DecodeFormat.ALWAYS_ARGB_8888ä½œä¸ºé¦–é€‰é…ç½®ã€‚

```java
builder.setDecodeFormat(DecodeFormat.ALWAYS_ARGB_8888);
```

## è‡ªå®šä¹‰ç›®æ ‡ï¼ˆTargetsï¼‰
é™¤äº†å¯ä»¥åŠ è½½å›¾åƒï¼Œè§†é¢‘å‰§ç…§ï¼ŒgifåŠ¨ç”»åˆ°Viewä¸­ï¼Œä½ è¿˜å¯ä»¥åŠ è½½ä»–ä»¬åˆ°å®ç°äº†Targetæ¥å£çš„è‡ªå®šä¹‰ç›®æ ‡ä¸­ã€‚

### SimpleTarget
å¦‚æœä½ åªæ˜¯æƒ³åŠ è½½ä¸€ä¸ªBitmapï¼Œå¹¶ä¸æƒ³ç›´æ¥å±•ç¤ºç»™ç”¨æˆ·è€Œæ˜¯æœ‰ä¸€äº›ç‰¹æ®Šç”¨é€”ï¼Œæ¯”å¦‚åœ¨é€šçŸ¥ä¸­æ˜¾ç¤ºæˆ–è€…ç”¨ä½œå¤´åƒä¸Šä¼ ã€‚
Glideä¹Ÿå¯ä»¥åšåˆ°ã€‚
SimpleTargetä¸ºTargetæ¥å£æä¾›äº†å¤§éƒ¨åˆ†çš„é»˜è®¤å®ç°ã€‚ä½ å¯ä»¥ä¸“æ³¨äºå¤„ç†åŠ è½½çš„ç»“æœã€‚
ä¸ºäº†ä½¿ç”¨SimpleTargetï¼Œä½ éœ€è¦åœ¨å®ƒçš„æ„é€ å‡½æ•°ä¸­æä¾›ä½ è¦åŠ è½½çš„èµ„æºçš„å®½å’Œé«˜ï¼ˆå•ä½åƒç´ ï¼‰ï¼Œä½ è¿˜éœ€è¦å®ç°` onResourceReady(T resource, GlideAnimation animation)`æ–¹æ³•ã€‚
ä¸€ä¸ªå…¸å‹çš„ä½¿ç”¨SimpleTargetçš„ä¾‹å­å¦‚ä¸‹:

```java
int myWidth = 512;
int myHeight = 384;
 
Glide.with(yourApplicationContext)) 
    .load(youUrl) 
    .asBitmap() 
    .into(new SimpleTarget<Bitmap>(myWidth, myHeight) {
        @Override 
        public void onResourceReady(Bitmap bitmap, GlideAnimation anim) {
            // Do something with bitmap here. 
        } 
    }; 
```

#### ä¸€äº›è­¦å‘Š
æ­£å¸¸æƒ…å†µä¸‹ï¼Œä½ åŠ è½½ä¸€ä¸ªèµ„æºä¼šæŠŠä»–ä»¬æ”¾åˆ°viewä¸­ã€‚å½“ä½ çš„Activityæˆ–è€…Fragmentè¢«pauseæˆ–è€…destroyæ—¶ï¼ŒGlideä¼šæš‚åœæˆ–å–æ¶ˆåŠ è½½ï¼Œç¡®ä¿ä½ ä¸ä¼šåŠ è½½é‚£äº›æ ¹æœ¬ä¸ä¼šæ˜¾ç¤ºçš„èµ„æºã€‚
å¯æ˜¯å½“æˆ‘ä»¬ä½¿ç”¨SimpleTargetçš„æ—¶å€™ï¼Œè¿™å¯èƒ½å¹¶ä¸æ˜¯æˆ‘ä»¬å¸Œæœ›çš„è¡Œä¸ºã€‚æ‰€æœ‰ï¼Œå½“ä½ è°ƒç”¨`Glide.with(context)`çš„æ—¶å€™ï¼Œä½ å¯ä»¥ä¼ å…¥Applicationçš„contextï¼Œè€Œä¸æ˜¯ä¼ å…¥Activityæˆ–è€…Fragmentã€‚
æ­¤å¤–ï¼Œè€ƒè™‘åˆ°é•¿æ—¶é—´çš„åŠ è½½æ“ä½œå¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼ï¼Œè¯·è€ƒè™‘ä½¿ç”¨é™æ€å†…éƒ¨ç±»ï¼Œè€Œä¸æ˜¯åŒ¿åå†…éƒ¨ç±»ã€‚

### ViewTarget
å¦‚æœä½ æƒ³åŠ è½½ä¸€ä¸ªå›¾ç‰‡åˆ°Viewä¸­ï¼Œä½†æ˜¯ä½ æƒ³è§‚å¯Ÿæˆ–è€…è¦†ç›–Glideçš„é»˜è®¤è¡Œä¸ºã€‚ä½ å¯ä»¥è¦†ç›–ViewTargetæˆ–è€…å®ƒçš„å­ç±»ã€‚
å½“ä½ æƒ³è®©Glideæ¥è·å–viewçš„çš„å¤§å°ï¼Œä½†æ˜¯æƒ³ä½ è‡ªå·±æ¥å¯åŠ¨åŠ¨ç”»å’Œè®¾ç½®èµ„æºåˆ°viewä¸­ï¼ŒViewTargetæ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ã€‚å¦‚æœä½ è¦åŠ è½½ä¸€ä¸ªå›¾ç‰‡åˆ°ImageViewä¹‹å¤–çš„è‡ªå®šä¹‰viewä¸­ï¼Œé‚£ä¹ˆImageViewTargetæˆ–è€…å®ƒçš„å­ç±»å°±ä¸èƒ½æ»¡è¶³ä½ çš„è¦æ±‚ï¼Œæ­¤æ—¶ç»§æ‰¿ViewTargetå°±ç‰¹åˆ«åˆé€‚ã€‚
ä½ å¯ä»¥é™æ€çš„å®šä¹‰ä¸€ä¸ªViewTargetçš„å­ç±»ï¼Œæˆ–è€…ä¼ é€’ä¸€ä¸ªåŒ¿åå†…éƒ¨ç±»åˆ°ä½ çš„åŠ è½½è°ƒç”¨é‡Œï¼š

```java
Glide.with(yourFragment)
    .load(yourUrl)
    .into(new ViewTarget<YourViewClass, GlideDrawable>(yourViewObject) {
        @Override
        public void onResourceReady(GlideDrawable resource, GlideAnimation anim) {
            YourViewClass myView = this.view;
            // Set your resource on myView and/or start your animation here.
        }
    });
```
æ³¨æ„ï¼Œå¦‚æœä½ æƒ³æŒ‡å®šåŠ è½½Bitmapè¿˜æ˜¯GifDrawableï¼Œè¯·åœ¨`.load(yourUrl)`è°ƒç”¨åé¢ç›´æ¥æ·»åŠ `.asBitmap()`æˆ–è€…`asGif()`ï¼ŒåŒæ—¶å°†ViewTargetçš„ç±»å‹å‚æ•°`GlideDrawable`æ¢æˆå¯¹åº”åŠ è½½çš„ç±»å‹ã€‚
ä¸ºäº†æ›´å¤šæ§åˆ¶ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨Targetå®ç°`LifecycleListener`å›è°ƒï¼Œ`onStart()`, `onStop()`, æˆ–è€…`onDestroy()`ä¼šå’Œä½ viewæ‰€åœ¨çš„fragmentçš„ç”Ÿå‘½å‘¨æœŸåŒæ­¥ã€‚
### è¦†ç›–é»˜è®¤è¡Œä¸º
å¦‚æœä½ åªæƒ³è§‚å¯Ÿä¸æƒ³ä¿®æ”¹Glideçš„é»˜è®¤è¡Œä¸ºï¼Œä½ å¯ä»¥ç»§æ‰¿ä»»ä½•ä¸€ä¸ªGlideå¯¹ImageViewTargetsçš„é»˜è®¤å®ç°ã€‚

* GlideDrawableImageViewTarget - é»˜è®¤çš„Targetï¼Œç”¨åšæ­£å¸¸çš„åŠ è½½ï¼Œå’Œ`asGif()`ã€‚
* BitmapImageViewTarget - å½“ä½¿ç”¨`asBitmap()`åŠ è½½æ—¶ï¼Œä½¿ç”¨çš„é»˜è®¤Targetã€‚

åªæœ‰ä½ åœ¨æ¯ä¸ªæ–¹æ³•é‡Œé¢è°ƒç”¨super()ï¼Œå°†ä¼šä¿ç•™é»˜è®¤çš„è¡Œä¸ºï¼ŒåŒæ—¶è¿˜å¯ä»¥æ·»åŠ ä¸€äº›ä½ å¸Œæœ›çš„åŠŸèƒ½ã€‚

ä¾‹å¦‚ï¼Œæƒ³è¦ç”Ÿæˆä¸€ä¸ª[è°ƒè‰²æ¿](http://chris.banes.me/2014/07/04/palette-preview/)ï¼Œä½ å¯ä»¥è¿™æ ·åšã€‚

```java
Glide.with(yourFragment) 
    .load(yourUrl) 
    .asBitmap() 
    .into(new BitmapImageViewTarget(yourImageView)) { 
        @Override 
        public void onResourceReady(Bitmap bitmap, GlideAnimation anim) {
            super.onResourceReady(bitmap, anim);
            Palette.generateAsync(bitmap, new Palette.PaletteAsyncListener() {  
                @Override 
                public void onGenerated(Palette palette) {
                    // Here's your generated palette 
                } 
            }); 
        } 
    }); 
```
è™½ç„¶è¿™ä¸ªä¾‹å­è¿˜ä¸é”™ï¼Œä½†æ˜¯ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä¸æ¨èç”¨è¿™ä¸ªæ–¹å¼ç”Ÿæˆè°ƒè‰²æ¿ã€‚è¯·æŸ¥çœ‹Glideçš„ `ResourceTranscoder` æ¥å£å’Œ`.transcode()`æ–¹æ³•ï¼Œè€ƒè™‘è¿”å›ä¸€ä¸ªåŒ…å«Bitmapå’Œè°ƒè‰²æ¿çš„è‡ªå®šä¹‰èµ„æºã€‚è°ƒè‰²æ¿å¯åœ¨åœ¨åå°çº¿ç¨‹ç”Ÿæˆã€‚ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿæ›´å¤šå†…å®¹ä¼šåœ¨ä»¥åæ¨å‡ºã€‚ã€‚ã€‚

## è°ƒè¯•å’Œé”™è¯¯å¤„ç†
Glideåœ¨åŠ è½½è¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸é»˜è®¤æƒ…å†µä¸‹ä¸ä¼šæ‰“æ—¥å¿—ã€‚Glideä¸ºä½ æä¾›äº†ä¸¤ç§æ–¹å¼æŸ¥çœ‹å’Œå¤„ç†è¿™äº›å¼‚å¸¸ã€‚
### è°ƒè¯•
ä»…ä»…ä¸ºäº†æŸ¥çœ‹å¼‚å¸¸çš„è¯ï¼Œä½ å¯ä»¥ä¸º`GenericRequest`ç±»æ‰“å¼€Debugæ—¥å¿—ã€‚è¿™ä¸ªç±»å¤„ç†æ‰€æœ‰åª’ä½“èµ„æºçš„åŠ è½½å“åº”ï¼ˆresponseï¼‰ã€‚ä½ å¯ä»¥åœ¨å‘½ä»¤è¡Œé‡Œè¿è¡Œï¼š

```xml
adb shell setprop log.tag.GenericRequest DEBUG
```
æƒ³è¦åŒ…æ‹¬è¯¦ç»†çš„è¯·æ±‚æ—¶åºä¿¡æ¯ï¼Œä½ å¯ä»¥æŠŠ`DEBUG`ç¼“å­˜`VERBOSE`ã€‚

å…³é—­æ—¥å¿—ä½¿ç”¨ï¼š

```xml
adb shell setprop log.tag.GenericRequest ERROR
```
### è°ƒè¯•[å·¥ä½œæµ](https://docs.google.com/drawings/d/1KyOJkNd5Dlm8_awZpftzW7KtqgNR6GURvuF6RfB210g/edit)
ä¸ºäº†æŸ¥çœ‹å†…éƒ¨å¼•æ“ï¼ˆengineï¼‰å¦‚ä½•ä»¥åŠä½•æ—¶æŸ¥æ‰¾åˆ°èµ„æºï¼Œä½ å¯ä»¥æ‰“å¼€æ—¥å¿—ï¼š

```xml
adb shell setprop log.tag.Engine VERBOSE
adb shell setprop log.tag.EngineJob VERBOSE
adb shell setprop log.tag.DecodeJob VERBOSE
```
æ‰“å¼€è¿™ä¸ªæœ‰åŠ©äºä½ æ‰¾å‡ºä¸ºä»€ä¹ˆæŸä¸ªèµ„æºæ²¡æœ‰ä»å†…å­˜ç¼“å­˜ä¸­åŠ è½½ï¼Œä¸ºä»€ä¹ˆè¯·æ±‚å†æ¬¡ä»å¤–éƒ¨çš„urlä¸‹è½½æ•°æ®ã€‚è¿™ä¹Ÿå¯ä»¥å¸®åŠ©ä½ äº†è§£ï¼šå¦‚æœæƒ³å‘½ä¸­ç£ç›˜ç¼“å­˜ï¼Œä»€ä¹ˆæ ·çš„å‚æ•°éœ€è¦åŒ¹é…ã€‚å¯ç”¨`DecodeJob`æ—¥å¿—ä¹Ÿå¯ä»¥å¸®åŠ©ä½ æ‰¾å»è‡ªå®šä¹‰transformation/decoder/encoderç›¸å…³çš„é—®é¢˜ã€‚

### ç›‘å¬è¯·æ±‚-RequestListener
è™½ç„¶å¯ç”¨debugæ—¥å¿—å¾ˆç®€å•ï¼Œä½†æ˜¯åªæœ‰åœ¨ä½ å¯ä»¥è¿æ¥åˆ°è®¾å¤‡æ—¶æ‰èƒ½è¿™æ ·å¹²ã€‚ä¸ºäº†æŠŠGlideæ•´åˆè¿›å·²æœ‰çš„æ›´ä¸“ä¸šçš„é”™è¯¯æ—¥å¿—ç³»ç»Ÿã€‚ä½ å¯ä»¥ä½¿ç”¨`RequestListener`ç±»çš„`onException()`ã€‚å½“è¯·æ±‚å¤±è´¥æ—¶ï¼Œè¯¥æ–¹æ³•ä¼šå‘ŠçŸ¥ä½ å¯¼è‡´å¤±è´¥çš„`å¼‚å¸¸`(Exception),å¦‚æœè§£ç å™¨ï¼ˆDecoderï¼‰ä¸èƒ½ä»æ•°æ®ä¸­è§£æå‡ºä»»ä½•æœ‰ç”¨çš„ä¿¡æ¯ã€‚Exceptionä¹Ÿå¯èƒ½ä¼ `null`ã€‚ä½ å¯ä»¥ä½¿ç”¨`listener()`APIä¼ ä¸€ä¸ªä½ çš„ç›‘å¬å™¨ï¼ˆlistenerï¼‰åˆ°æ¯ä¸€ä¸ªè¯·æ±‚ä¸­ã€‚
è¯·ç¡®ä¿`onException()`è¿”å›`false`ã€‚ä»¥å…è¦†ç›–äº†Glideçš„é»˜è®¤é”™è¯¯å¤„ç†è¡Œä¸ºã€‚ï¼ˆä¾‹å¦‚ï¼Œé€šçŸ¥`Target`è¿™ä¸ªerrorï¼‰
è¿™æ˜¯ä¸€ä¸ªå¿«é€Ÿè°ƒè¯•çš„ä¾‹å­ï¼š

```java
// example usage: .listener(new LoggingListener<String, GlideDrawable>()) 
public class LoggingListener<T, R> implements RequestListener<T, R> {
    @Override public boolean onException(Exception e, Object model, Target target, boolean isFirstResource) {
        android.util.Log.d("GLIDE", String.format(Locale.ROOT,
                "onException(%s, %s, %s, %s)", e, model, target, isFirstResource), e);
        return false; 
    } 
    @Override public boolean onResourceReady(Object resource, Object model, Target target, boolean isFromMemoryCache, boolean isFirstResource) {
        android.util.Log.d("GLIDE", String.format(Locale.ROOT,
                "onResourceReady(%s, %s, %s, %s, %s)", resource, model, target, isFromMemoryCache, isFirstResource));
        return false; 
    } 
} 
```
**ç¡®ä¿å‘ç‰ˆå‰ç§»é™¤æ‰€æœ‰ä½¿ç”¨è¿™ä¸ªç±»çš„åœ°æ–¹**

### æ›´å¤šæ—¥å¿—
è¿™ä¸ªåˆ—è¡¨æ˜¯ç»™3.6.0ç‰ˆæœ¬ç”¨çš„ï¼Œå¯èƒ½ä¸å®Œæ•´ã€‚

```xml
cd .../android-sdk/platform-tools
adb shell setprop log.tag.AnimatedGifEncoder VERBOSE
adb shell setprop log.tag.AssetUriFetcher VERBOSE
adb shell setprop log.tag.BitmapEncoder VERBOSE
adb shell setprop log.tag.BufferedIs VERBOSE
adb shell setprop log.tag.ByteArrayPool VERBOSE
adb shell setprop log.tag.CacheLoader VERBOSE
adb shell setprop log.tag.ContentLengthStream VERBOSE
adb shell setprop log.tag.DecodeJob VERBOSE
adb shell setprop log.tag.DiskLruCacheWrapper VERBOSE
adb shell setprop log.tag.Downsampler VERBOSE
adb shell setprop log.tag.Engine VERBOSE
adb shell setprop log.tag.EngineRunnable VERBOSE
adb shell setprop log.tag.GenericRequest VERBOSE
adb shell setprop log.tag.GifDecoder VERBOSE
adb shell setprop log.tag.GifEncoder VERBOSE
adb shell setprop log.tag.GifHeaderParser VERBOSE
adb shell setprop log.tag.GifResourceDecoder VERBOSE
adb shell setprop log.tag.Glide VERBOSE
adb shell setprop log.tag.ImageHeaderParser VERBOSE
adb shell setprop log.tag.ImageVideoDecoder VERBOSE
adb shell setprop log.tag.IVML VERBOSE
adb shell setprop log.tag.LocalUriFetcher VERBOSE
adb shell setprop log.tag.LruBitmapPool VERBOSE
adb shell setprop log.tag.MediaStoreThumbFetcher VERBOSE
adb shell setprop log.tag.MemorySizeCalculator VERBOSE
adb shell setprop log.tag.PreFillRunner VERBOSE
adb shell setprop log.tag.ResourceLoader VERBOSE
adb shell setprop log.tag.RMRetriever VERBOSE
adb shell setprop log.tag.StreamEncoder VERBOSE
adb shell setprop log.tag.TransformationUtils VERBOSE
```